title: 设计模式part1 简介
author: gsal
date: 2018-05-08 18:24:29
tags:
---
### 四个基本要素
模式名称、问题、解决方案、后果

### 模式分类
- 代码模式
- 设计模式
 - 创建模式
 - 结构性模式
 - 行为模式
- 架构模式

### 设计原则
提高系统复用性的设计原则。设计模式是招式，而这些是内功。

#### 开-闭原则
真正的宗旨和目标。一个实体应该对扩展开放，对修改关闭。即在设计一个模块的时候，应当使这个模块可以在较小修改的前提下被扩展。并可以在不必修改源代码的情况下改变这个模块的行为。   
解决方案：抽象化。系统定义一个不可更改的抽象层。  
开闭原则的工程思想：对可变性的封装。 
一种可变性不应当与另一种可变性混合。所有的类图的继承结构一般都不会超过两层，不然就意味着将两种不同的可变性混合。   
将条件转移语句改写为多态（谨慎使用，可能会造成多态污染）

#### 里氏代换原则
在所有场合，子类必须能够替代父类。method(father）必然可以method(son)。 （问题：java里的多态不就天然满足这一条了吗？）。违反里氏代换原则必然违背开闭原则，反之则不然。   
里氏代换对编程的要求：
1. 子类必须具备基类的全部接口
1. 子类必须包括比基类型更宽的接口。（private->protected->public）  

在语义上也必须满足里氏代换原则。即鸟为基类有飞的方法，然后子类有fly方法，但是一调用就throw异常，这会通过编译器的检查（syntax），但是语义上就不正确，因此要自己保证，必须是扩展子类的方法。  

#### 依赖倒转原则
要依赖于抽象，不要依赖于实现。比如要依赖于List，不要依赖于ArrayList。再比如一个网站有登录的功能，可能是扫描人脸登录，指纹登录，或者用户名密码登录，如果说你整个系统都是依赖于用户名密码登录的，那么就不满足这个原则了，因为你的抽象层次依赖于了具体的层次。正确的做法是依赖于登录的接口，就可以更容易地更改登录的实现。  
做法：面向接口编程。比如以下情况：声明变量类型、声明方法的返回类型、数据类型的转换等等。比如声明一个List而不是一个ArrayList，表示我关注的只是一个List，而不是ArrayList。  
耦合关系：
1. 零耦合
1. 抽象耦合
1. 具体耦合

依赖倒转可以从具体耦合到抽象耦合。  
不容易实现：会导致大量的类，维护难度大。不排除有一些具体类相当稳定。

#### 接口隔离原则
一个类对另一个类的依赖性应当建立在最小的接口上。比如A依赖B中的一个方法，结果你给我10个方法，我只用到1个方法。尽可能让一个类依赖少的东西。  
使用多个专门的接口比使用一个接口更好。      

#### 合成/聚合复用原则
尽量使用合成/聚合而不是继承来达到对实现的复用。继承只使用于"is a"关系，比如大杯咖啡是不加奶咖啡吗？不是，所以最好不用要继承。继承的缺点：将超类的实现细节暴露给子类；超类的改变，使得子类的实现也不得不发生改变（自动就随之而变了）。  
这里注意，子类里面不能访问父类的private方法和变量，但是如果子类继承了父类的public方法，而这个方法又调用了父类的private变量是可以的。  
而遵循合成/聚合复用法则的话，就可以将已有的对象纳入到新对象中，成为新对象的一部分，新的对象可以调用已有对象的功能。比如人（新对象）有一双手（成分对象），这里手就是一个接口。  
优点：
1. 黑盒复用
1. 需要的依赖较少
1. 每一个新的类可以聚焦
1. 可以动态修改  

缺点： 类比较多    
##### 合成与聚合的区别
聚合：整体与部分的关系——鸟与鸟群
合成：强得多的拥有关系——人与脑袋，部分和整体的生命周期相同。新对象拥有对组成部分的支配权
#### 迪米特法则
一个对象应当对其他对象有尽可能少的了解。最少知识原则
表述：
1. 只与你直接的朋友们通信
1. 不要与陌生人说话
如果两个类不必彼此直接通信，那么应该通过第三个类来调用方法。再比如员工与区域经理与总经理，员工不要与总经理直接通信，不要越权操作。（怎么判断越权操作了呢？）

### 设计原则应用实例分析
**题目**：用类FileName描述文件名。有人认为FileName是string类的特殊情况．因此应当把FileName设计成string类的子类，然后加上FileName类所需的方法。请用里氏代换原则分析这个做法是否正确。  

**回答**：里氏代换原则：如果一个方法对一个基类成立的话．那么一定适用于其子类。
FileName类如果是string的子类，那么应实现string的所有方法。
string有方法add:string+string→string。
但 add:FileName+FileName不一定成立
即文件名相加却不一定给出一个新的有效 文件名。
即 FileName对象并不能实现 striog 对象的所有行为。（Filename是字符串，但是不是String类）。

**题目**：用迪米特法则考察下列说法  
用迪米特法则考察下面的说法：
1. 你走你的阳关道，我走我的独木桥。
2. 井水不犯河水。 
3. 城门失火，殃及池鱼
4. 四海之内皆兄弟。

**答案**:  
1 ． 2 ．ＯＫ  
这两个说法都是建议减少与外界的联系。这样一旦外界出现变化，不会立即波及到自身。它们都是迪米特法则的同义语  
3 ．这个说法是从反面说明迪米特法则的重要性。当城门失火的时候，人们会使月护城河的水救火，自然就会影响到护城何中的鱼。聪明的鱼应当生活在远离城门的地方．这是来自迪米特法则的建议。   
4 ．是违背迪米特法则的，如果系统的软件模块都像兄弟一样“亲近”，系统的设计就是失败的。  




